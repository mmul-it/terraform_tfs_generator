---

- name: Deploy general resources templates
  template:
    src: "{{ item }}.tf.j2"
    dest: "{{ terraform_output_dir }}/{{ item }}.tf"
  with_items:
    - "{{ azure_resources }}"

- name: Deploy VPN resources templates
  template:
    src: "{{ item }}.tf.j2"
    dest: "{{ terraform_output_dir }}/{{ item }}.tf"
  with_items:
    - "{{ azure_vpn_resources }}"
  when:
    - localnetworkgws is defined

- name: Deploy machine specific templates
  template:
    src: template.tf.j2
    dest: "{{ terraform_output_dir }}/{{ group.key }}.tf"
  with_dict:
    - "{{ groups }}"
  loop_control:
    loop_var: group
  when:
    - group.key not in ('all', 'ungrouped')
